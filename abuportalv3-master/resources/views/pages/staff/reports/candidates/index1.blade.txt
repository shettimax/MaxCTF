<?php
/**
 * Created with NetBeans.
 * User: Ridwan
 * Date: 6/22/2018
 * Time: 9:40 AM
 */
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;
?>

@extends('layouts.alt.master')
<style>
    .borderless td, .borderless th {
        border: none !important;
    }
</style>
@section('content')
    <div class="main-section">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card">
                        <h2 class = "display-6">Applicants Report</h2>
                        <form>
                            <div class="card-body" style="width: 150%;">
                                @if (session('status'))
                                    <div class="alert alert-success" role="alert">
                                        {{ session('status') }}
                                    </div>
                                @endif

                                @csrf
                                <div class="form-row">
                                    <div class="col-md-4 mb-3" style="width: 200px;">
                                        <label for="faculty">Faculty:</label>
                                        <select id="faculty" name="faculty" class="form-control {{ $errors->has('faculty')?'is-invalid':'is-valid' }}" required>
                                            <option value="">--select--</option>

                                        </select>

                                    </div>

                                    <div class="col-md-4 mb-3" style="width: 200px;">
                                        <label for="department">Department:</label>
                                        <select id="department" name="department" class="form-control {{ $errors->has('department')?'is-invalid':'is-valid' }}" required>
                                            <option value="">--select--</option>

                                        </select>
                                    </div>

                                    <div class="col-md-4 mb-3" style="width: 200px;">
                                        <label for="progtype">Programme Type:</label>
                                        <select id="progtype" name="progtype" class="form-control {{ $errors->has('progtype')?'is-invalid':'is-valid' }}" required>
                                            <option value="">--select--</option>

                                        </select>
                                    </div>

                                    <div class="col-md-4 mb-3" style="width: 200px;">
                                        <label for="programme">Programme:</label>
                                        <select id="programme" name="programme" class="form-control {{ $errors->has('programme')?'is-invalid':'is-valid' }}" required>
                                            <option value="">--select--</option>

                                        </select>
                                    </div>

                                    <div class="col-md-4 mb-3" style="width: 200px;">
                                        <label for="session">Session:</label>
                                        <select id="session" name="session" class="form-control {{ $errors->has('session')?'is-invalid':'is-valid' }}" required>
                                            <option value="">--select--</option>

                                        </select>
                                    </div>

                                    <div class="col-md-4 mb-3" style="width: 200px;">
                                        <label for="paystatus">Payment Status:</label>
                                        <select id="paystatus" name="paystatus" class="form-control {{ $errors->has('paystatus')?'is-invalid':'is-valid' }}" required>
                                            <option value="">--select--</option>

                                        </select>
                                    </div>

                                    <div class="col-md-4 mb-3" style="width: 200px;">
                                        <label for="submissionstatus">Submission Status:</label>
                                        <select id="submissionstatus" name="submissionstatus" class="form-control {{ $errors->has('paystatus')?'is-invalid':'is-valid' }}" required>
                                            <option value="">--select--</option>
                                            <option value='%'>All</option>
                                            <option value='Submitted'>Submitted</option>
                                            <option value='Not Submitted'>Not Submitted</option>
                                        </select>
                                    </div>

                                </div>
                                <br />
                                <div class="form-row" >
                                    <table style="width: 80%" class="borderless centered">
                                        <caption><h3>Select fields to display </h3></caption>
                                        <tr>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="gender"/></td><td>Gender</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="dateofbirth"/></td><td>Date of Birth</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="currentcontact"/></td><td>Contact Address</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="gsm"/></td><td>Phone Number</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="email"/></td><td>E-Mail</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="lgaid"/></td><td>State</td>
                                            <!--<td><input type="checkbox" name="selected" id="selected" class="fields" value="lga"/></td><td>LGA</td>-->
                                        </tr>
                                        <tr>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="paystatus"/></td><td>Payment Status</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="facultyid"/></td><td>Faculty</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="departmentid"/></td><td>Department</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="programmeid"/></td><td>Programme</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="programmetypeid"/></td><td>Programme Type</td>
                                            <td><input type="checkbox" name="selected" id="selected" class="fields" value="admissionstatus"/></td><td>Admission Status</td>
                                        </tr>
                                        <tr>
                                            <td colspan="6" id="prog" style="text-align:center;"><div style="display:none;" id="progimg" ><img src="./images/loader.gif"/><span style="color:green;font-size:large">Loading...</span></div></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="form-row">

                                    <div class="col-md-6 mb-3">
                                        <div class="form-group">
                                            <button type="submit" id="generatebtn" class="btn btn-success text-right">Generate</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                        <div class="container table-responsive" id="result_div">
                            {!! $dataTable->table(['class' => 'table table-bordered table-condensed']) !!}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    @push('scripts')
        {!! $dataTable->scripts() !!}
    @endpush
    <script type='text/javascript'>
        jQuery(document).ready(function(){
        $.ajax('{{route("reports.getfaculties")}}')
            .done(function(msg){
                jQuery("#faculty").html("<option value=''>--select--</option>"+msg);
            });

        //Return departments on select of faculty
        jQuery("#faculty").live("change", function(){
            jQuery("#department").html("<option value=''>Loading...</option>");
            $.ajax({
                url: '{{route("reports.getdepartments")}}',
                type:'GET',
                data:{
                    facultyid:jQuery("#faculty").val()
                }
            }).done(function(msg){
                jQuery("#department").html("<option value=''>--select--</option>"+msg);
                jQuery("#progtype").val("");
                jQuery("#programme").val("");
                jQuery("#session").val("");
                jQuery("#paystatus").val("");
                jQuery("#submissionstatus").val("");
            });
        });

        //Return programme types on select of department
        jQuery("#department").live("change", function(){
            jQuery("#progtype").html("<option value=''>Loading...</option>");
            $.ajax({
                url: '{{route("reports.getprorammetypes")}}',
                type:'GET',
                data:{
                    departmentid:jQuery("#department").val()
                }
            }).done(function(msg){
                jQuery("#progtype").html("<option value=''>--select--</option>"+msg);
                jQuery("#programme").val("");
                jQuery("#session").val("");
                jQuery("#paystatus").val("");
                jQuery("#submissionstatus").val("");
            });
        });

        //Return programmes on select of programme type
        jQuery("#progtype").live("change", function(){
            jQuery("#programme").html("<option value=''>Loading...</option>");
            $.ajax({
                url: '{{route("reports.getprogrammes")}}',
                type:'GET',
                data:{
                    facultyid:jQuery("#faculty").val(),
                    departmentid:jQuery("#department").val(),
                    programmetypeid:jQuery("#progtype").val()
                }
            }).done(function(msg){
                jQuery("#programme").html("<option value=''>--select--</option>"+msg);
                jQuery("#session").val("");
                jQuery("#paystatus").val("");
                jQuery("#submissionstatus").val("");
            });
        });

            $.ajax('{{route("reports.getsessions")}}')
                .done(function(msg){
                    jQuery("#session").html("<option value=''>--select--</option>"+msg);
                });

            $.ajax('{{route("reports.getpaystatus")}}')
                .done(function(msg){
                    jQuery("#paystatus").html("<option value=''>--select--</option>"+msg);
                });

        jQuery("#generatebtn").live("click", function(){
            var selecteditems = new Array();
            jQuery("input:checkbox[name=selected]:checked").each(function() {
                selecteditems.push(jQuery(this).val());
            });
           // alert(jQuery("#faculty").val()+" "+jQuery("#department").val()+" "+jQuery("#progtype").val()+" "+jQuery("#programme").val())
             $.ajax({
                url:'{{route("reports.candidates.index")}}}',
                type:'GET',
                data:{
                    selecteditems:selecteditems,
                    facultyid:jQuery("#faculty").val(),
                    departmentid:jQuery("#department").val(),
                    programmetypeid:jQuery("#progtype").val(),
                    programmeid:jQuery("#programme").val(),
                    paystatus:jQuery("#paystatus").val(),
                    session:jQuery("#session").val(),
                    submissionstatus:jQuery("#submissionstatus").val()
                }
            }).done(function(msg){
             });
        });
        });

    </script>
@endsection
