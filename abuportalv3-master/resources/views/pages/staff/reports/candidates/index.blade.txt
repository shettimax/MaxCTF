@extends('pages.staff.reports.candidates.generalfilterform')
@section('css')
    @parent
    <style type='text/css'>

    </style>
@endsection

@section('content')
    @parent
@endsection
@section('filterselect')
    <div class="col-md-3 mb-3">
        <label for="paystatus">Payment Status:</label>
        <select id="paystatus" name="paystatus"
                class="form-control {{ $errors->has('paystatus')?'is-invalid':'is-valid' }}">
            <option value="">--select--</option>
            <option value='%'>All Status</option>
            <option value='Paid'>Paid</option>
            <option value='Not Paid'>Not Paid</option>
        </select>
    </div>
<br /><br />
    <div class="col-md-3 mb-3">
        <label for="submissionstatus">Completion Status:</label>
        <select id="submissionstatus" name="submissionstatus"
                class="form-control {{ $errors->has('paystatus')?'is-invalid':'is-valid' }}"
                required>
            <option value="">--select--</option>
            <option value="">All Status</option>
            <option value='Submitted'>Completed</option>
            <option value='Not Submitted'>Not Completed</option>
        </select>
    </div>
@endsection

@section('reporttb')
@if (count($candidates) > 0)
    @include('pages.staff.reports.candidates.load_data')
@endif
@endsection

@section('js')
    @parent
    <script type='text/javascript'>

        function formatMoney(n, c, d, t) {
            var c = isNaN(c = Math.abs(c)) ? 2 : c,
                d = d == undefined ? "." : d,
                t = t == undefined ? "," : t,
                s = n < 0 ? "-" : "",
                i = String(parseInt(n = Math.abs(Number(n) || 0).toFixed(c))),
                j = (j = i.length) > 3 ? j % 3 : 0;
            return s + (j ? i.substr(0, j) + t : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + t) + (c ? d + Math.abs(n - i).toFixed(c).slice(2) : "");
        };

    jQuery(document).ready(function()
    {
        jQuery(document).on("submit", "#reportForm", function (event) {
            event.preventDefault();
            jQuery(".loader").fadeIn();
            $.ajax({
                type: 'GET',
                //error: function (data) {
                  //  alert (data);
                //},
                url: '{{route('reports.candidates.applied')}}',
                data: {
                    "faculty": jQuery('#faculty').val(),
                    "department": jQuery('#department').val(),
                    "progtype": jQuery('#progtype').val(),
                    "programme": jQuery('#programme').val(),
                    "session": jQuery('#session').val(),
                    "paystatus": jQuery('#paystatus').val(),
                    "submissionstatus": jQuery('#submissionstatus').val()
                },
                success: function (response) {
                    console.log(response);
                    jQuery(".loader").fadeOut();
                    jQuery("#records").html(response);
                    jQuery('#reporttb').DataTable({
                        dom: 'Bfrtip', 
                        lengthMenu:[25, 50, 75, 100],
                        pageLength: 100,
                        buttons: [
                        {
                            extend: 'copyHtml5',
                            exportOptions: {
                                columns: ':visible'
                            }
                        },
                        {
                            extend: 'excelHtml5',
                            exportOptions: {
                                columns: ':visible'
                            }
                        },
                        {
                            extend: 'pdfHtml5',
                            orientation: 'landscape',
                            pageSize: 'LEGAL',
                            exportOptions: {
                                columns: ':visible'
                            }
                        },
                        {
                            extend: 'print',
                            messageTop: 'Candidates Report',
                            orientation: 'landscape',
                            pageSize: 'LEGAL'
                        },
                        {
                            extend: 'colvis',
                            columns: ':not(.noVis)',
                            collectionLayout: 'fixed two-column',
                            postfixButtons: [ {
                                extend:'colvisGroup',
                                text:'Show all',
                                show:':hidden'
                            } ]
                        }
                    ],
                    language: {
                        buttons: {
                            colvis: 'Show/Hide columns'
                        }
                    },
                        //buttons: ['excel', 'pdf', 'print'],
                        "footerCallback": function (row, data, start, end, display) {
                        var api = this.api();
                        var json = api.ajax.json();
                        // Remove the formatting to get integer data for summation
                        var intVal = function ( i ) {
                            return typeof i === 'string' ?
                                i.replace(/[\$,]/g, '')*1 :
                                typeof i === 'number' ?
                                    i : 0;
                        };

                        // Total over all pages

                        if (api.column(7).data().length){
                            var total = api
                                .column( 7 )
                                .data()
                                .reduce( function (a, b) {
                                    return intVal(a) + intVal(b);
                                } ) }
                        else{ total = 0};

                        // Total over this page

                        if (api.column(7).data().length){
                            var pageTotal = api
                                .column( 7, { page: 'current'} )
                                .data()
                                .reduce( function (a, b) {
                                    return intVal(a) + intVal(b);
                                } ) }
                        else{ pageTotal = 0};

                        // Update footer
                        jQuery( api.column(7).footer() ).html(
                            "Page Total: " + formatMoney(pageTotal) + "<br> Grand Total: " + formatMoney(total)
                        );

                    }
                    });
                }
            });
        });
    });

    </script>
@endsection
