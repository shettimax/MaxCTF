<?php
/**
 * Created by PhpStorm.
 * User: Lwafu
 * Date: 01/09/2018
 * Time: 06:57
 */
?>
@extends('layouts.alt.master')
<style>
    .borderless td, .borderless th {
        border: none !important;
    }
</style>
@section('content')
    @include('pages.staff.reports.filters.basicfilters')

    <div class="container">
        <div class="row">
            <div class="col-md-10 col-md-offset-1">
                <div class="panel panel-default">
                    <div class="panel-heading">Applicants Report</div>

                    <div class="panel-body">
                        <table class="table table-hover table-bordered table-striped applied-datatable" style="width:100%">
                            <thead>
                            <tr>
                                <th>Candidate ID</th>
                                <th>Name</th>
                                <th>RRR</th>
                            </tr>
                            </thead>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type='text/javascript'>

        jQuery(document).ready(function() {

            $.ajax('{{route("reports.getfaculties")}}')
                .done(function(msg){
                    jQuery("#faculty").html("<option value=''>--select--</option>"+msg);
                });

            //Return departments on select of faculty
            jQuery("#faculty").live("change", function(){
                jQuery("#department").html("<option value=''>Loading...</option>");
                $.ajax({
                    url: '{{route("reports.getdepartments")}}',
                    type:'GET',
                    data:{
                        facultyid:jQuery("#faculty").val()
                    }
                }).done(function(msg){
                    jQuery("#department").html("<option value=''>--select--</option>"+msg);
                    jQuery("#progtype").val("");
                    jQuery("#programme").val("");
                    jQuery("#session").val("");
                    jQuery("#paystatus").val("");
                    jQuery("#submissionstatus").val("");
                });
            });

            //Return programme types on select of department
            jQuery("#department").live("change", function(){
                jQuery("#progtype").html("<option value=''>Loading...</option>");
                $.ajax({
                    url: '{{route("reports.getprorammetypes")}}',
                    type:'GET',
                    data:{
                        departmentid:jQuery("#department").val()
                    }
                }).done(function(msg){
                    jQuery("#progtype").html("<option value=''>--select--</option>"+msg);
                    jQuery("#programme").val("");
                    jQuery("#session").val("");
                    jQuery("#paystatus").val("");
                    jQuery("#submissionstatus").val("");
                });
            });

            //Return programmes on select of programme type
            jQuery("#progtype").live("change", function(){
                jQuery("#programme").html("<option value=''>Loading...</option>");
                $.ajax({
                    url: '{{route("reports.getprogrammes")}}',
                    type:'GET',
                    data:{
                        facultyid:jQuery("#faculty").val(),
                        departmentid:jQuery("#department").val(),
                        programmetypeid:jQuery("#progtype").val()
                    }
                }).done(function(msg){
                    jQuery("#programme").html("<option value=''>--select--</option>"+msg);
                    jQuery("#session").val("");
                    jQuery("#paystatus").val("");
                    jQuery("#submissionstatus").val("");
                });
            });

            $.ajax('{{route("reports.getsessions")}}')
                .done(function(msg){
                    jQuery("#session").html("<option value=''>--select--</option>"+msg);
                });

            jQuery('.applied-datatable').DataTable({
                processing: true,
                serverSide: true,
                deferLoading: 0,
                 ajax: {
                    url: '{{ url("/reports/candidates/applied-data") }}',
                    type: 'GET',
                    data: function (d) {
                        return $.extend({}, d, {
                            "facultyid": 11,
                            "departmentid": jQuery('#department').val(),
                            "programmetypeid": jQuery('#progtype').val(),
                            "programmeid": jQuery('#programme').val(),
                            "paystatus": jQuery('#paystatus').val(),
                            "session": jQuery('#session').val(),
                            "submissionstatus": jQuery('#submissionstatus').val()
                         });
                    },
                    'headers': {
                        'X-CSRF-TOKEN': '{{ csrf_token() }}'
                    }
                },
                fixedHeader: {
                    header: true,
                    footer: false
                },
                columns: [
                   {data: 'candID'},
                    {data: 'surname'}
                    //{data: 'transamount', name:'transamount'},
                    //{data: 'rrr', name:'rrr'}
                   // {data: 'id'}
                    //{data: 'email'}
                    //{data: 'surname'}
                ]
            });

            jQuery("#generatebtn").live("click", function(e){
                oTable.ajax.url('/reports/candidates/applied-data').load();
                //oTable.draw();
                e.preventDefault();
            });

        });
    </script>
@endsection
