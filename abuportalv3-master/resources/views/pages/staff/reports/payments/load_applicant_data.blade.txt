<div id="load" style="position: relative;" class="table-responsive">
    <table id="reporttb" class="table table-striped table-bordered table-hover table-condensed nowrap">
        <thead>
        <tr>
            <th>S/N</th>
            <th>Application No.</th>
            <th>Email</th>
            <th>Candidate ID</th>
            <th>JAMB No.</th>
            <th>JAMB Score</th>
            <th>PUTME Score</th>
            <th>Full Name</th>
            <th>Amount</th>
            <th>Gender</th>
            <th>Phone</th>
            <th>Date</th>
            <th>Programme</th>
            <th>Department</th>
            <th>Faculty</th>
            <th>State</th>
            <th>LGA</th>
            <th>Session</th>
            <th>RRR</th>
            <th>Transaction ID</th>
            <th>O-levels</th>
            <th>A-levels</th>
            <th>A-ID</th>
            <th>A-levels Type</th>
            <th>A-levels Grade</th>
            <th>Institution</th>
            <th>Registration No</th>
            <th>CGPA</th>
            <th>Level</th>
            <th>Transcript</th>
        </tr>
        </thead>

        <tfoot>
        <tr>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
            <th></th>
        </tr>
        </tfoot>

        <tbody>

        @foreach ($students as $stud)
            @php
                $qual = [];
                $alevel = [];

                $alevel = explode("@",$stud->alevel);
                $qual = explode('|',count($alevel)?$alevel[0]:"");
                $ilast = count($qual)-1;
                $school = empty(trim($stud->school_attended))?(object)[
                    'school'=>"",
                    'reg_number'=>"",
                    'level'=>"",
                    'cgpa'=>"",
                    'transcript'=>""]:
                    json_decode($stud->school_attended);

            @endphp
            <tr>
                <td>{{$loop->index+1}}</td>
                <td>{{ $stud->appno}}</td>
                <td>{{ $stud->email}}</td>
                <td>{{ $stud->candid}}</td>
                <td>{{ $stud->username}}</td>
                <td>{{ $stud->jamb_score}}</td>
                <td>{{ $stud->putme_score ?? 'N/A' }}</td>
                <td>{{ $stud->fullname }}</td>
                <td>{{ $stud->transaction_amount }}</td>
                <td>{{ $stud->gender }}</td>
                <td>{{ $stud->gsm }}</td>
                <td>{{ $stud->date }}</td>
                <td>{{ $stud->programme}} </td>
                <td>{{ $stud->department }}</td>
                <td>{{ $stud->faculty }}</td>
                <td>{{ $stud->state }}</td>
                <td>{{ $stud->lga }}</td>
                <td>{{  $stud->session }}</td>
                <td>{{  $stud->invoice_number }}</td>
                <td>{{  $stud->transaction_code }}</td>
                <td>{{  $stud->olevel }}</td>
                <td>{{  str_replace("@",", ",$stud->alevel) }}</td>
                <td>{{$stud->candalevelid}}</td>
                <td>{{  isset($qual[0])?$qual[0]:"" }}</td>
                <td>{{  count($qual)?$qual[$ilast]:"" }}</td>
                <th>{{isset($school->school)?$school->school:""}}</th>
                <th>{{isset($school->reg_number)?$school->reg_number:""}}</th>
                <th>{{isset($school->cgpa)?$school->cgpa:""}}</th>
                <th>{{isset($school->level)?$school->level:""}}</th>
                <th>
                    @if(isset($school->transcript) && file_exists(public_path("uploads/").$school->transcript))
                        <a href="{{asset("uploads/".$school->transcript?:"")}}" target="_blank">Download</a>
                    @endif
                </th>
            </tr>
        @endforeach
        </tbody>
    </table>
</div>
