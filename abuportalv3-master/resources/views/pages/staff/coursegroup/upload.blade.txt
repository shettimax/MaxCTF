<?php
/**
 * Created by PhpStorm.
 * User: Galadima
 * Date: 5/20/2019
 * Time: 4:12 PM
 */

?>


@extends('layouts.master')

@section('content')
    <div class="main-section">
        <div class="container">
            <div class="row justify-content-center">
                <ul class="nav nav-tabs">
                    <li class="nav-item"><a class="nav-link" href="{{route('shortlist')}}">Shortlist Applicants</a></li>
                    <li class="nav-item"><a class="nav-link active" href="{{route('admittedupload')}}">Upload
                            Applicants</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{route('uploadscore')}}">Upload Applicants'
                            Results</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{route('change.programme')}}">Change Applicant's
                            Programme</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{route('applicant.transaction.status')}}">Applicant's
                            Transaction Status</a></li>
                </ul>
                <br/>
                <div class="col-md-12">
                    <div class="card">
                        <h2 class="display-6">Upload Admitted Applicants</h2>
                        <form action="{{route("preview.admittedupload")}}" method="post" enctype="multipart/form-data">
                            <div class="card-body" style="width: 150%;">
                                @if (session('status'))
                                    <div class="alert alert-success" role="alert">
                                        {{ session('status') }}
                                    </div>
                                @endif

                                @csrf
                                <div class="form-row">
                                    <div class="col-md-4 mb-3" style="width: 150px;">
                                        <label for="session">Session:</label>
                                        <select id="sessionid" name="session" size=""
                                                class="custom-select form-control course-select {{ $errors->has('session')?'is-invalid':'is-valid' }}"
                                                required>
                                            <option value="">--Select--</option>
                                            @foreach(range(date("Y")-10, date("Y")) as $year)
                                                <option value="{{ $year }}">{{ $year }}/{{ $year+1 }}</option>
                                            @endforeach
                                        </select>
                                    </div>
                                    <div class="col-md-4 mb-3" style="width: 150px;">
                                        <label for="row">Specify the row at which the records start from the
                                            excel:</label>
                                        <select name="row" required>
                                            <?php
                                            for ($i = 0; $i <= 20; $i++) {
                                            ?>
                                            <option value="<?php echo $i ?>"><?php echo $i + 2 ?></option>
                                            <?php
                                            }
                                            ?>
                                        </select>
                                    </div>

                                </div>
                                <div class="form-row">
                                    <div class="col-md-3 mb-3">
                                        <label for="faculty">Faculty: </label>
                                        <select
                                            class="form-control form-control-lg {{ $errors->has('faculty')?'is-invalid':'is-valid' }}"
                                            name="faculty" id="faculty" required>
                                            <option value="">Select...</option>
                                            <option value="all">All Faculties</option>
                                            @foreach(\App\Models\Faculty::where("id",">",0)->orderBy("name")->get()  as $faculty)
                                                <option value="{{$faculty->id}}">{{$faculty->name}}</option>
                                            @endforeach
                                        </select>
                                        @if($errors->has('faculty'))
                                            <div class="invalid-feedback" style="color:red;">
                                                {{ $errors->first('faculty')}}
                                            </div>
                                        @endif
                                    </div>
                                    <div class="col-md-3 mb-3">
                                        <label for="department">Department: </label>
                                        <select
                                            class="form-control form-control-lg {{ $errors->has('department')?'is-invalid':'is-valid' }}"
                                            name="department" id="department" required>
                                            <option value="">Select...</option>
                                        </select>
                                        @if($errors->has('department'))
                                            <div class="invalid-feedback" style="color:red;">
                                                {{ $errors->first('department')}}
                                            </div>
                                        @endif
                                    </div>
                                    <div class="col-md-2 mb-2">
                                        <label for="programme">Programme: </label>
                                        <select
                                            class="form-control form-control-lg {{ $errors->has('programme')?'is-invalid':'is-valid' }}"
                                            name="programme" id="programme" required>
                                            <option value="">Select...</option>
                                        </select>
                                        @if($errors->has('programme'))
                                            <div class="invalid-feedback">
                                                {{ $errors->first('programme')}}
                                            </div>
                                        @endif
                                    </div>
                                </div><!-- end of form row-->
                                <br/>
                                <br/>
                                <div class="form-row">
                                    <div class="col-md-4 mb-3">
                                        <input type="file" name="filename" required/>
                                    </div>

                                    <div class="col-md-4 mb-3">
                                        <button type="submit" id="submitbtn" class="btn btn-success text-right">Upload
                                        </button>
                                    </div>

                                </div>
                                <div class="row">
                                    <div class="col-md-5 mb-4">
                                        <table class="table table-bordered"
                                               style="font-size:14px;font-family: Calibri;">
                                            <h6 style="color:red !important;">Upload Format:
                                                <small style="color:red !important;">This must have the header as shown
                                                    (Application Number) <a
                                                        href="{{asset('sample_upload_file/candidate_upload_sample.xlsx')}}">
                                                        Click here to download sample </a></small>
                                            </h6>
                                            <tr>
                                                <th>Application Number</th>
                                            </tr>
                                            <tr>
                                                <td>0000123692017</td>
                                            </tr>
                                            <tr>
                                                <td>0000323692017</td>
                                            </tr>
                                            <tr>
                                                <td>0000673692017</td>
                                            </tr>
                                            <tr>
                                                <td>0000813692017</td>
                                            </tr>
                                            <tr>
                                                <td>0000473692017</td>
                                            </tr>
                                            <tr>
                                                <td>0000728992017</td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                @if(isset($success))
                    <div class="container card">
                        <div class="card-title" style="text-align: center"><h4>Summary of the Upload</h4></div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <h5>Successfully Admitted</h5>
                                    <ol>
                                        @foreach(array_unique($success) as $ss)
                                            <li class="text text-success">{{$ss}}</li>
                                        @endforeach
                                    </ol>
                                </div>
                                <div class="col-md-4">
                                    <h5>Failed</h5>
                                    <ol>
                                        @foreach(array_unique($failed) as $ff)
                                            <li class="text text-danger">{{$ff}}</li>
                                        @endforeach
                                    </ol>
                                </div>
                                <div class="col-md-4">
                                    <h5>Duplicate</h5>
                                    <ol>
                                        @foreach($duplicate as $dd)
                                            <li class="text text-warning">{{$dd}}</li>
                                        @endforeach
                                    </ol>
                                </div>
                            </div>
                        </div>
                    </div>
                @endif
            </div>
        </div>
    </div>
    <script>
        $(function () {
            $("body").on("change", "#faculty", function () {
                var id = $(this).val();
                $("#department").empty();
                $("#department").append("<option value=''>Select...</option>");
                $.getJSON("{{ url('ajax/departments') }}/" + id, function (obj) {
                    $.each(obj, function (key, value) {
                        $("#department").append("<option value='" + value.id + "'>" + value.name + "</option>");
                    });
                });
            });
            $("body").on("change", "#department", function () {
                var deptid = $(this).val();
                $("#programme").empty();
                $("#programme").append("<option value=''>Select...</option>");
                $.getJSON("{{ url('ajax/programmes') }}/" + deptid, function (obj) {
                    $.each(obj, function (key, value) {
                        $("#programme").append("<option value='" + value.id + "'>" + value.name + "</option>");
                    });
                });
            });
        });
        $('#search').click(function () {
            var appno = $('#appno').val();
            $.ajax({
                type: "GET",
                url: "{{ route('search.applicant.id',['']) }}/" + appno
            }).done(function (data) {
                $('#info').html(data);
            });
        });
    </script>
@endsection
