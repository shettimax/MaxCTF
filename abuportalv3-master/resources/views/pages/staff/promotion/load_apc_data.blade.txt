<div id="load" style="position: relative;" class="table-responsive">
    <table id="reporttb" class="table table-striped table-bordered table-hover table-condensed nowrap">
        <thead class="thead-light">
        <tr class="text-dark text-uppercase">
            <th><input type="checkbox" id="selectAll"></th>
            <th class="no-sort">Action</th>
            <th>SN</th>
            <th>Year</th>
            <th>Complex</th>
            <th>Faculty</th>
            <th>Department</th>
            <th>Title</th>
            <th>Personnel Number</th>
            <td>Name</td>
            <th>Date of Appointment</th>
            <th>Date of Confirmation</th>
            <th>Date of Last Promotion</th>
            <td>Rank/Salary</td>
            <th>Waiting Period</th>
            <th>HOD Recommendation</th>
            <th>Dean Recommendation</th>
            <th>Complex Recommendation</th>
            <th>Recommended Rank</th>
            <th>Verification Status</th>
            <th>Council Approval</th>
        </tr>
        </thead>
        <tbody>

        @foreach ($staffs as $staff)
            @php
                $year = Carbon\Carbon::now()->year;
                $lpro = Carbon\Carbon::parse($staff->dolp);
                 $yearOfLastPromotion=$lpro->format('Y');
                $c=$year - $yearOfLastPromotion;

            @endphp
            <tr>
                <td><input type="checkbox" class="staffCheckbox" name="staff_ids[]" value="{{ $staff->id }}"></td>
                <td>
                    <a id="sendBtn" class="btn btn-info btn-xs print"
                    href="{{ route('staff.profile.cv.generate.html', $staff->employee_id) }}" target="_blank" title="View CV">CV</a> |
                    <a id="sendBtn" class="btn btn-info btn-xs print"
                        href="{{ route('staff.summary.view',[ $staff->employee_id,'year'=>$year]) }}" target="_blank" title="View Summary Sheet">SM</a>
                    @php
                        $salaryPresent = explode('/',$staff->present_salary_step);
                        $rankText = $salaryPresent[0];
                        $grade = $salaryPresent[1];
                        $rank = \App\Models\Rank::where('gradelevel',trim($grade))->first();
                        $step = $salaryPresent[2];
                        $rankOnEmpl = \App\Models\Rank::find($staff->rank_on_employment);

                    @endphp
                    @if($type!='council' && $staff->council_approval !="Approved")
                    | <a class="btn btn-sm btn-primary editRec"
                        data-name="{{$staff->title}} {{$staff->name}}"
                        data-personnel_no="{{$staff->personnel_no}}"
                        data-dofapt="{{$staff->dofapt}}"
                        data-_id__="{{$staff->id}}"
                        data-doc="{{$staff->doc}}"
                        data-dolp="{{$staff->dolp}}"
                        data-rank_id="{{$rank?->id}}"
                        data-rank_on_empl_id="{{$rankOnEmpl->id}}"
                        data-apc_rank_id="{{$staff->apc_rank_id?$staff->apc_rank_id:$staff->recommended_rank_id}}"
                        data-rank_on_empl_text="{{$rankOnEmpl?->name}}"
                        data-rec-rank="{{$staff->recommended_rank}}"
                        data-apc_step="{{$staff->apc_step}}"

                    >edit / recommend</a>
                    @elseif($staff->council_approval !="Approved")
                    | <a class="btn btn-sm btn-warning appr"
                        data-id="{{$staff->id}}" uri="{{ route('promotion.council.approve') }}"

                    >approve</a>
                    @endif

                    @if($staff->council_approval =="Approved")
                        <a class="btn btn-sm btn-warning"
                        target="_blank" href="{{ route('staff.profile.promotion',[$staff->id]) }}">View Letter</a>
                    @endif

                </td>
                <td>{{$loop->index+1}}</td>
                <td>{{$staff->year}}</td>
                <td>{{$staff->complex_name}}</td>
                <td>{{$staff->faculty_name}}</td>
                <td>{{$staff->department_name}}</td>
                <td>{{$staff->title}}</td>
                <td>{{ $staff->personnel_no}}</td>
                <td>{{ $staff->name }}</td>
                <td>{{ $staff->dofapt }}</td>
                <td>{{ $staff->doc}}</td>
                <td>{{ $staff->dolp}} </td>
                <td>{{ $staff->present_salary_step}} </td>
                <td>{{ $c}} </td>
                <td>{{$staff->unit_status}}</td>
                <td>{{$staff->faculty_status}}</td>
                <td>{{$staff->complex_status}}</td>
                <td>{{$staff->recommended_rank}}</td>
                <td>
                    @php
                        $verificationStatusClass = '';
                        switch($staff->verification_status) {
                            case 'Pending':
                                $verificationStatusClass = 'label-warning';
                                break;
                            case 'Approved':
                                $verificationStatusClass = 'label-success';
                                break;
                            case 'Rejected':
                                $verificationStatusClass = 'label-danger';
                                break;
                            default:
                                $verificationStatusClass = 'label-default';
                        }
                    @endphp
                    <span class="label {{ $verificationStatusClass }}">
                        {{ $staff->verification_status ?? 'Pending' }}
                    </span>
                </td>
                <td>{{$staff->council_approval}}</td>
            </tr>
        @endforeach
        </tbody>
    </table>
    <button type="button" id="updateButton" class="btn btn-primary">Recommend Selected</button>
</div>
