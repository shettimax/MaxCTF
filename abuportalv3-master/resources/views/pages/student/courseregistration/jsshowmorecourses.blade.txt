<script type = "text/javascript">
    //Shows modal dialog for showing more courses
    $(document).on('click', '#showmorecourses-link', function(){
        $('#showcourses_modal').modal();
        $("#faculty").html("<option value = ''>loading...</option>");
        //Renders faculty dropdown on modal dialog box
        $.ajax({
            type:'POST',
            url: '@php echo route('courseregistration.getfaculties') @endphp',
            dataType: 'json',
            data:{
                _token: '<?php echo csrf_token() ?>'
            },
            success:function(data){
                options = "";
                $.each(data, function(idx, val){
                    options+="<option value = '"+val.id+"'>"+val.name+"</option>";
                });
                $("#faculty").html("<option value = ''>--select--</option>" + options);
            }
        });
        return false;
    });

    //On change of faculty, then render department dropdown and attempt to get Courses To Register
    $(document).on('change', '#faculty', function(){
        $("#department").html("<option value = ''>loading...</option>");
        $.ajax({
            type:'POST',
            url: '@php echo route('courseregistration.getdepartments') @endphp',
            dataType: 'json',
            data:{
                facultyid: $(this).val(),
                _token: '<?php echo csrf_token() ?>'
            },
            success:function(data){
                options = "";
                $.each(data, function(idx, val){
                    options+="<option value = '"+val.id+"'>"+val.name+"</option>";
                })
                $("#department").html("<option value = ''>--select--</option>" + options);
                getCoursesToRegister($("#courselevel").val(), $("#department").val())
            }
        });
    });


    //On change of more courses
    $(document).on('change', '#morecourses', function(){
        $("#morecourses-btn-div").html("<button type='button' class='btn btn-primary' id = 'showmorecourses-btn'>Show In List</button>");
    });



    //On change of department, then attempt to get Courses To Register
    $(document).on('change', '#department', function(){
        getCoursesToRegister($("#courselevel").val(), $(this).val())
    });

    //On change of courseleve, then attempt to get Courses To Register
    $(document).on('change', '#courselevel', function(){
        getCoursesToRegister($(this).val(), $("#department").val())
    });

    //Action to show a course on the course registration form (showMoreCourses)
    $(document).on('click', '#showmorecourses-btn', function(){
        $.ajax({
            type:'POST',
            url: '@php echo route('courseregistration.getmorecourses',[$session]) @endphp',
            dataType: 'json',
            data:{
                course_id: $("#morecourses").val(),
                _token: '<?php echo csrf_token() ?>'
            },
            success:function(data){
                if($("input[course_id='"+data.course.id+"']").length > 0){
                    $("#morecourses-btn-div").html("<div class = 'alert alert-danger'>Already exist</div>");
                }else{
                    //Gets last row serial number
                    sn = $('.xCountx').length+1;
                    //Gets a dropdown that contains preconfigured course groups for both lab and lectures
                    coursegroups = getConfiguredCourseGroups($("#morecourses").val());
                    lecturedropdown = coursegroups[0];
                    labdropdown = coursegroups[1];
                    //Append new rows to existing rows on course form
                    $("#courses-to-register-table").append("<tr><td class='xCountx'>"+sn+"</td><td>"+data.course.coursecode+"</td><td>"+data.course.coursetitle+"</td><td>"+data.course.courseunit+"</td><td>E</td><td><a href='#' class='course-info' course_id='"+$("#morecourses").val()+"'><i class = 'fa fa-info-circle' style = 'line-height:3; color: blue;'></i></a></td><td>"+lecturedropdown+"</td><td>"+labdropdown+"</td><td><input type = 'checkbox' class = 'register-course-chkbox' course_id = '"+data.course.id+"' lecture_group_id = '' lab_group_id = ''></td></tr>");
                    $("#morecourses-btn-div").html("<div class = 'alert alert-success'>Successfully added to course list.</div><div class='alert alert-warning'><p><strong>Note:</strong></p><p>You have to choose lecture/lab group on the course list table and check to add to your course form.</p></div>");
                    $("#showcourses_modal").modal('hide');
                }
            }
        });
    });
</script>
