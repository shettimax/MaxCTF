<?php

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        // Add indexes for room occupancy report optimization
        Schema::table('reservations', function (Blueprint $table) {
            $table->index(['student_id', 'session'], 'idx_reservations_student_session');
            $table->index(['room_config_id', 'status'], 'idx_reservations_room_status');
            $table->index(['session', 'status'], 'idx_reservations_session_status');
        });

        Schema::table('room_configs', function (Blueprint $table) {
            $table->index(['room_id'], 'idx_room_configs_room');
        });

        Schema::table('rooms', function (Blueprint $table) {
            $table->index(['block_id'], 'idx_rooms_block');
            $table->index(['room_no'], 'idx_rooms_room_no');
        });

        Schema::table('blocks', function (Blueprint $table) {
            $table->index(['hostel_id'], 'idx_blocks_hostel');
            $table->index(['status'], 'idx_blocks_status');
        });

        Schema::table('hostels', function (Blueprint $table) {
            $table->index(['status'], 'idx_hostels_status');
        });

        Schema::table('students', function (Blueprint $table) {
            $table->index(['matric_number'], 'idx_students_matric');
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::table('reservations', function (Blueprint $table) {
            $table->dropIndex('idx_reservations_student_session');
            $table->dropIndex('idx_reservations_room_status');
            $table->dropIndex('idx_reservations_session_status');
        });

        Schema::table('room_configs', function (Blueprint $table) {
            $table->dropIndex('idx_room_configs_room');
        });

        Schema::table('rooms', function (Blueprint $table) {
            $table->dropIndex('idx_rooms_block');
            $table->dropIndex('idx_rooms_room_no');
        });

        Schema::table('blocks', function (Blueprint $table) {
            $table->dropIndex('idx_blocks_hostel');
            $table->dropIndex('idx_blocks_status');
        });

        Schema::table('hostels', function (Blueprint $table) {
            $table->dropIndex('idx_hostels_status');
        });

        Schema::table('students', function (Blueprint $table) {
            $table->dropIndex('idx_students_matric');
        });
    }
};