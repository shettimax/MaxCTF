<?php
// Simple test file to debug payment data
header('Content-Type: application/json');

// Include Laravel bootstrap
require __DIR__.'/../vendor/autoload.php';
$app = require_once __DIR__.'/../bootstrap/app.php';
$kernel = $app->make(Illuminate\Contracts\Http\Kernel::class);

try {
    // Test if transactions exist for 2019
    $transactions2019 = \DB::table('transactions')
        ->where('session', '2019')
        ->count();
    
    // Test if session_regs exist for 2019
    $sessionRegs2019 = \DB::table('session_regs')
        ->where('session', '2019')
        ->count();
    
    // Test if there are any transactions with REG code
    $regTransactions = \DB::table('transactions')
        ->where('code', 'REG')
        ->where('session', '2019')
        ->count();
    
    // Test if there are any paid transactions
    $paidTransactions = \DB::table('transactions')
        ->where('payment_status', 'Paid')
        ->where('session', '2019')
        ->count();
    
    // Test specific faculty/department combination
    $specificQuery = \DB::table('transactions')
        ->join('session_regs', 'transactions.student_id', '=', 'session_regs.student_id')
        ->join('students', 'students.id', '=', 'session_regs.student_id')
        ->join('programmes', 'students.programme_id', '=', 'programmes.id')
        ->join('departments', 'programmes.department_id', '=', 'departments.id')
        ->join('faculties', 'departments.faculty_id', '=', 'faculties.id')
        ->where('transactions.session', '2019')
        ->where('session_regs.session', '2019')
        ->where('faculties.id', 1)
        ->where('departments.id', 13)
        ->where('transactions.code', 'REG')
        ->where('transactions.payment_status', 'Paid')
        ->count();
    
    echo json_encode([
        'status' => 'success',
        'transactions_2019' => $transactions2019,
        'session_regs_2019' => $sessionRegs2019,
        'reg_transactions_2019' => $regTransactions,
        'paid_transactions_2019' => $paidTransactions,
        'specific_query_count' => $specificQuery
    ]);
} catch (\Exception $e) {
    echo json_encode([
        'status' => 'error',
        'message' => $e->getMessage(),
        'file' => $e->getFile(),
        'line' => $e->getLine()
    ]);
}

