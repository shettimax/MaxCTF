<?php
namespace App\Exports;

use App\Models\Hostel;
use App\Models\Block;
use App\Models\Room;
use Maatwebsite\Excel\Concerns\WithMultipleSheets;
use Maatwebsite\Excel\Concerns\Exportable;
use Maatwebsite\Excel\Concerns\FromArray;
use Maatwebsite\Excel\Concerns\WithTitle;

class ReservationTemplateExport implements WithMultipleSheets
{
    use Exportable;

    public function sheets(): array
    {
        return [
            new MainSheet(),
            new RoomListSheet(),
        ];
    }
}

class MainSheet implements FromArray, WithTitle
{
    public function array(): array
    {
        return [
            ['Registration Number', 'Hostel', 'Block', 'Room (optional)'], // headers
            ['', '', '', '']
        ];
    }

    public function title(): string
    {
        return 'Reservation Template';
    }
}
class RoomListSheet implements FromArray, WithTitle
{
    public function array(): array
    {
       $rooms = Room::select('rooms.*')
    ->join('blocks', 'rooms.block_id', '=', 'blocks.id')
    ->join('hostels', 'blocks.hostel_id', '=', 'hostels.id')
    ->with(['block.hostel'])
    ->orderBy('hostels.name')
    ->orderBy('blocks.name')
    ->orderBy('rooms.room_no')
    ->get()
    ->map(function ($room) {
        return [
            $room->block->hostel->name,
            $room->block->name,
            $room->room_no,
        ];
    })
    ->toArray();


        return array_merge([['Hostel', 'Block', 'Room']], $rooms);
    }

    public function title(): string
    {
        return 'Room List';
    }
}