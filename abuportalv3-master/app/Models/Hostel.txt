<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Database\Query\Builder;
use App\Models\Student;
use \App\Models\Block;

class Hostel extends Model {

    //
    protected $table = 'hostels';

    public function blocks() {
        return $this->hasMany('App\Models\Block', 'hostel_id', 'id');
    }

    public function getReservableBlock(Student $student, $isadmin = false) {
        return Accommodation::getReservableBlocks($student,[$this]);
        $blocks = array();
        $gender = strtolower($student->gender);
         $blocksbuilder =  Block::where([
                    ['hostel_id', $this->id],
                    ['status', '1']])->whereRaw("gender='$gender' OR gender='combined'");

        if (!$isadmin) {
            $blocksbuilder =$blocksbuilder->where(function ($query) use ($student) {
                $query->whereIn('studtype', ['all', Accommodation::getStudTypeSpec(array(Accommodation::getProgCode($student->programme()->programmetype->progtypename)))]);
            });
        }
        $blocksbuilder = $blocksbuilder->orderBy('name', 'asc');
        $sql = $blocksbuilder->toSql();
       // var_dump($sql); exit();
        $blocks = $blocksbuilder->get();
        //echo count($blocks); exit();
        return $blocks;
    }

}
