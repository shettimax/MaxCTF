<?php

namespace App\Models;

use Illuminate\Database\Eloquent\Model;
use Illuminate\Support\Facades\DB;

class CourseRegistration extends Model {

    protected $fillable = ['student_id', 'course_group_id'];

    public function courseGroup()
    {
        return $this->belongsTo(CourseGroup::class);
    }

    public function student()
    {
        return $this->belongsTo(Student::class);
    }

    public static function getCourseRegisteredByStudent($student, $session) {
        $courses = DB::table('course_registrations')
                ->join('course_groups', 'course_groups.id', '=', 'course_registrations.course_group_id')
                ->select('course_registrations.*')
                ->where([
                    ['course_groups.session', $session],
                    ['course_registrations.student_id', $student->id]
                ])
                ->get();
        return $courses;
    }

    public static function getCourseRegisteredByStudentIn($student, $session,$semester=1) {
        $courses = DB::table('course_registrations')
            ->join('course_groups', 'course_groups.id', '=', 'course_registrations.course_group_id')
            ->join('courses','courses.id','=','course_groups.course_id')
            ->select(['course_registrations.*','courses.*'])
            ->where([
                ['course_groups.session', $session],
                ['course_registrations.student_id', $student->id]
            ])->groupBy("courses.id");
        if($semester!==0) $courses->where("course_groups.semester","=",$semester);
        $courses = $courses->get();
        return $courses;
    }
}
