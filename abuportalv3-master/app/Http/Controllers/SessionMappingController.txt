<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\SessionMapping;
use Illuminate\Support\Facades\Auth;

class SessionMappingController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth:staff');
    }

    public function index()
    {
//        
        $user = Auth::user();

        return view('pages.staff.settings.manage_session_mappings',compact('user'));
    }

    public function store(Request $request)
    {
//        try {
            if (!$this->access(Auth::user(), 'complex')) {
                return view("pages.staff.error.access");
            }
          

            $this->validate($request, [
                'form_session' => 'required',
                'cur_session' => 'required',
                'faculty' => 'required',
                'progtype' => 'required'
            ]);
            
            
            $DB = new SessionMapping();
            $DB->form_session = $request->form_session;
            $DB->session = $request->cur_session;
            $DB->faculty_id = $request->faculty;
            $DB->programme_type_id = $request->progtype;
            $DB->save();


            if ($request->rank_id > 0)
                $request->session()->flash('flash_message', 'Rank has been updated');
            else
                $request->session()->flash('flash_message', 'Rank has been added');
            return redirect()->back();

    }

    public function edit($id)
    {
        $model = SessionMapping::find($id);
        if (!$this->access(Auth::user(), "complex"))
            return view("pages.errors.nopermission");

        return view('pages.staff.settings.manage_session_mappings', compact('model'));
    }
}
