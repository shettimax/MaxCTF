<?php

namespace App\Http\Controllers\Student;

use App\Models\Candidate;
use App\Http\Controllers\Controller;
use App\Http\CuteBanker\SchoolCollection;
use App\Models\SundryTransaction;
use App\Models\Transaction;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
class ABUMFBController extends Controller
{
    //

    public function __construct()
    {
        $this->middleware(["auth:student","mmode"]);
    }

    public function create(Request $request)
    {
//        return [env("PUSHER_APP_SECRET")];
        $student =  Auth::user();
        if($student->wallet_number){
            return redirect(route("student.dashboard"));
        }
        return view("pages.student.abumfb.create");
    }

    public function store(Request $request)
    {

        $student =  Auth::user();
        if($student->wallet_number){
            return redirect(route("student.dashboard"));
        }
        $schoolCollect = new SchoolCollection();
        $responseCode = $schoolCollect->createAccount($student);

        return response()->json(["status"=>$responseCode==1,"message"=>($responseCode==1?"Account creation successful":"Account creation failed.")],200);

    }


    public function makePay(Request $request)
    {
        $transaction = Transaction::find($request->trxn56xid77);
        $schoolCollect = new SchoolCollection();

        return response()->json($schoolCollect->payWallet($transaction));


    }


    public function balance(Request $request)
    {
        $student =  Auth::user();
        $schoolCollect = new SchoolCollection();
        return response()->json($schoolCollect->balance($student->wallet_number));
    }

    public function makeSundryPayment(Request $request)
    {
        $transaction = SundryTransaction::find($request->trxn56xid77);
        $schoolCollect = new SchoolCollection();

        return response()->json($schoolCollect->paySundry($transaction));


    }

    public function makeVivaPayment(Request $request)
    {
        $transaction = SundryTransaction::find($request->trxn56xid77);
        $schoolCollect = new SchoolCollection();

        return response()->json($schoolCollect->payViva($transaction));


    }
}
