<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\ExternalPgSupervisor;
use Illuminate\Support\Facades\Auth;

class ExternalSupervisorController extends Controller
{
    public function __construct()
    {
        $this->middleware('auth:staff');
    }

    public function index()
    {
//
        $user = Auth::user();

        return view('pages.staff.settings.manageexternalsupervise',compact('user'));
    }

    public function store(Request $request)
    {
//        try {
//            if (!$this->access(Auth::user(), 'complex')) {
//                return view("pages.staff.error.access");
//            }

//return $request;
            $this->validate($request, [
                'candidate_id' => 'required',
                'candidate_name' => 'required',
                'dissertation_title' => 'required',
                'supervisor' => 'required',
                'category' => 'required',
                'faculty' => 'required',
                'department' => 'required'
            ]);

    
            $DB = new ExternalPgSupervisor();
            $DB->candidate_id = $request->candidate_id;
            $DB->candidate_name = $request->candidate_name;
            $DB->dissertation_title = $request->dissertation_title;
            $DB->supervisor = $request->supervisor;
            $DB->category = $request->category;
            $DB->faculty = $request->faculty;
            $DB->department = $request->department;
            $DB->save();


            if ($request->candidate_id > 0)
                $request->session()->flash('flash_message', 'Candidate has been updated');
            else
                $request->session()->flash('flash_message', 'Candidate has been added');
            return redirect()->back();

    }

    public function edit($id)
    {
        $model = ExternalPgSupervise::find($id);
        if (!$this->access(Auth::user(), "complex"))
            return view("pages.errors.nopermission");

        return view('pages.staff.settings.manageexternalsupervise', compact('model'));
    }
}
