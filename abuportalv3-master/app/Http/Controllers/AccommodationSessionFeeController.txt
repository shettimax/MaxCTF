<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class AccommodationSessionFeeController extends Controller
{
    /**
     * Display a listing of the resource.
     *
     * @return \Illuminate\Http\Response
     */
    public function index()
    {
        $fees = AccommodationSessionFee::with('programmeType')->paginate(10);
        return view('accommodation-session-fees.index', compact('fees'));
    }

    public function create()
    {
        $programmeTypes = ProgrammeType::pluck('prog_type_name', 'prog_type_code');
        $unitTypes = ['Hostel' => 'Hostel', 'Block' => 'Block', 'Room' => 'Room', 'All' => 'All'];
        return view('accommodation-session-fees.create', compact('programmeTypes', 'unitTypes'));
    }

    public function store(Request $request)
    {
        $validated = $request->validate([
            'student_type' => 'required',
            'unit_type' => 'required|in:Hostel,Block,Room,All',
            'unit_id' => 'required|integer',
            'session' => 'required|digits:4',
            'amount' => 'required|numeric|min:0',
        ]);

        AccommodationSessionFee::create($validated);
        return redirect()->route('accommodation-session-fees.index')->with('success', 'Fee added successfully.');
    }

    public function edit(AccommodationSessionFee $accommodationSessionFee)
    {
        $programmeTypes = ProgrammeType::pluck('prog_type_name', 'prog_type_code');
        $unitTypes = ['Hostel' => 'Hostel', 'Block' => 'Block', 'Room' => 'Room', 'All' => 'All'];
        return view('accommodation-session-fees.edit', compact('accommodationSessionFee', 'programmeTypes', 'unitTypes'));
    }

    public function update(Request $request, AccommodationSessionFee $accommodationSessionFee)
    {
        $validated = $request->validate([
            'student_type' => 'required',
            'unit_type' => 'required|in:Hostel,Block,Room,All',
            'unit_id' => 'required|integer',
            'session' => 'required|digits:4',
            'amount' => 'required|numeric|min:0',
        ]);

        $accommodationSessionFee->update($validated);
        return redirect()->route('accommodation-session-fees.index')->with('success', 'Fee updated successfully.');
    }

    public function destroy(AccommodationSessionFee $accommodationSessionFee)
    {
        $accommodationSessionFee->delete();
        return redirect()->route('accommodation-session-fees.index')->with('success', 'Fee deleted successfully.');
    }
}
