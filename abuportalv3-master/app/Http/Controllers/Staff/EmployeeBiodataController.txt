<?php

namespace App\Http\Controllers\Staff;

use App\Models\Employee;
use App\Http\Controllers\Controller;
use function GuzzleHttp\Psr7\get_message_body_summary;
use Illuminate\Http\Request;
use Auth;
use App\Models\SalaryGradeLevel;

//use PhpOffice\PhpWord\IOFactory;
//use PhpOffice\PhpWord\PhpWord;

class EmployeeBiodataController extends Controller
{



    public function __construct()
    {
        $this->middleware(["auth:staff"]);
    }
    //
    public function index(){
//        return Auth::user();
        try{
            $employee = Employee::find(Auth::user()->employee_id);
            return view("pages.staff.profile.biodata", compact("employee"));
        }catch (\Exception $e){
            return redirect()->back()->with("error", $e->getMessage());
        }
    }

    public function dashboard(){
//        return Auth::user();
        try{
            $employee = Employee::find(Auth::user()->employee_id);
//            return $employee;
            return view('pages.staff.profile.dashboard', compact('employee'));
        }catch(\Exception $e){
            return redirect()->back()->with("error", $e->getMessage());
        }
    }

    public function appointment(){
        try{
            $employee = Employee::find(Auth::user()->employee_id);
            return view('pages.staff.profile.appointment', compact('employee'));
        }catch(\Exception $e){
            return redirect()->back()->with("error", $e->getMessage());
        }
    }

    public function updateAppointment(Request $request){
//        return $request;
        try{
            $this->validate($request,[
//                'employee_id' => 'required',
                'date_of_first_appointment' => 'required',
                'department' => 'required',
                'rank' => 'required'
            ]);
            $employee = Employee::find(Auth::user()->employee_id);
            $employee->ippis_no = $request->ippis_no;
            $employee->nhf = $request->nhf;
            $employee->nin = $request->nin;
            $employee->tin = $request->tin;
            $employee->type = $request->type;
            $employee->date_of_first_appointment = $request->date_of_first_appointment;
            $employee->date_of_last_promotion = $request->date_of_last_promotion;
            $employee->date_of_confirmation = $request->date_of_confirmation;
            $employee->date_of_redesignation = $request->date_of_redesignation;
            $employee->rank_id = $request->rank;
            $employee->rank_on_employment = $request->emrank;
            $employee->salary_grade_level_id = $request->salary_step;
            $employee->google_scholar_id = $request->google_scholar_id;
            $employee->scopus_id = $request->scopus_id;
            $employee->orcid_id = $request->orcid_id;
            $employee->doi = $request->doi;
            $employee->department_id = $request->department;
//            $employee->rank_id = $request->rank;
            $employee->save();
            return redirect()->back()->with("success", 'Done!');

        }catch(\Exception $e){
            return redirect()->back()->with("error", $e->getMessage());
        }
    }

    public function storeBiodata(Request $request){
        try{
            $this->validate($request,[
//                'employee_id' => 'required',
                'title' => 'required',
                'surname' => 'required',
                'firstname' => 'required',
                'marital_status' => 'required',
                'gender' => 'required',
                'nationality' => 'required',
                'lga' => 'required',
                'permanent_address' => 'required',
                'email'=>"required|email"
            ]);
            $user = Auth::user();
            $employee = Employee::find(Auth::user()->employee_id);
            $employee->title = $request->title;
            $employee->surname = $request->surname;
            $employee->firstname = $request->firstname;
            $employee->othernames = $request->othernames;
            $employee->marital_status = $request->marital_status;
            $employee->gender = $request->gender;
            $employee->country_id = $request->nationality;
            $employee->lga_id = $request->lga;
            $employee->email = $request->email;
            $employee->place_of_birth = $request->place_of_birth;
            $employee->permanent_address = $request->permanent_address;
            if(!$employee->date_of_birth){
                $employee->date_of_birth = $request->date_of_birth;
            }
            $employee->save();
            $user->email = $request->email;
            $user->save();

            return redirect()->back()->with("success", 'Done!');

        }catch(\Exception $e){
            return redirect()->back()->with("error", $e->getMessage());
        }
    }

}
