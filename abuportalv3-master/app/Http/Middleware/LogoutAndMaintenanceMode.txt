<?php

namespace App\Http\Middleware;

use Closure;
use Illuminate\Support\Facades\Artisan;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\DB;
class LogoutAndMaintenanceMode
{
    public function handle($request, Closure $next)
    {
        // Log out all users
        Auth::logout();
        if(DB::table('maintenance_modes')->value('enabled')){
            // Enable maintenance mode
//            Artisan::call('down', [
//                '--message' => 'Under maintenance. Please try again later.',
//                '--retry' => 60, // Number of seconds to wait before retrying
//            ]);
            return response()->view('pages.maintenance.index');
        }
        // Continue with the request
        return $next($request);
    }
}
